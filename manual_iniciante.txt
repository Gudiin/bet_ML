MANUAL T√âCNICO & CONCEITUAL - SISTEMA DE PREVIS√ÉO DE ESCANTEIOS (BET ML)
==========================================================================

Este guia possui duas camadas:
1.  **Conceitual:** Para entender a l√≥gica geral.
2.  **Deep Dive (T√©cnico):** Para entender a matem√°tica e engenharia "under the hood".

---

1. O ALGORITMO DE MACHINE LEARNING (O C√âREBRO)
----------------------------------------------

### Conceito
N√£o usamos uma simples "m√©dia de cantos". Usamos um modelo chamado **LightGBM**, que √© um algoritmo de **Gradient Boosting**. 
Imagine uma confer√™ncia de 500 especialistas fracos (√°rvores de decis√£o pequenas), onde cada um tenta corrigir os erros do anterior.

### üß† Deep Dive T√©cnico
*   **Algoritmo:** LightGBM (Light Gradient Boosting Machine).
*   **Objective Function (Fun√ß√£o de Perda):** Usamos a distribui√ß√£o **Tweedie** (`objective='tweedie'`).
    *   *Por que Tweedie?* A distribui√ß√£o Normal (Gaussiana) assume n√∫meros sim√©tricos (ex: altura das pessoas). Escanteios n√£o podem ser negativos e t√™m uma cauda longa √† direita (muitos jogos com 8-12, poucos com 25). A Tweedie com `variance_power=1.5` (Compound Poisson-Gamma) √© perfeita para modelar dados de contagem com "zeros" ou valores baixos.
*   **Valida√ß√£o Temporal (Time Series Split):**
    *   *O Erro Comum:* Muitos Data Scientists iniciantes embaralham os dados (`shuffle=True`). Isso faz o modelo "ver o futuro" (prever um jogo de 2023 usando dados de 2024).
    *   *Nossa Solu√ß√£o:* Usamos janelas deslizantes estritas. O treino √© SEMPRE no passado em rela√ß√£o ao teste.
    *   `Train: [Jan-Ago] -> Test: [Set]`
    *   `Train: [Jan-Set] -> Test: [Out]`

---

2. ESTAT√çSTICA: POISSON vs BINOMIAL NEGATIVA
--------------------------------------------

### Conceito
Escanteios s√£o eventos de contagem. Na estat√≠stica cl√°ssica, usa-se **Poisson**. O problema da Poisson √© que ela assume que a instabilidade (Vari√¢ncia) √© igual √† M√©dia. No futebol, isso raramente √© verdade (times s√£o inst√°veis).

### üß† Deep Dive T√©cnico
O Sistema faz um teste de hip√≥tese autom√°tico a cada jogo (`src/analysis/statistical.py`):

*   **C√°lculo da Dispers√£o:**
    Calculamos a m√©dia ($\lambda$) e a vari√¢ncia ($\sigma^2$) dos √∫ltimos jogos.

*   **Cen√°rio A: Equidispers√£o ($\sigma^2 \approx \lambda$)**
    *   Usamos **Poisson**: $P(k) = \frac{\lambda^k e^{-\lambda}}{k!}$
    *   Ideal para times consistentes (ex: Manchester City).

*   **Cen√°rio B: Overdispersion ($\sigma^2 > \lambda$)**
    *   Usamos **Binomial Negativa**.
    *   Esta distribui√ß√£o possui um par√¢metro extra para "absorver" a vari√¢ncia extra. Ela "alarga" as probabilidades, reduzindo a confian√ßa em eventos extremos e evitando falsos positivos.
    *   *Tradu√ß√£o:* Se o time √© louco, o modelo reduz a 'Confian√ßa' da aposta automaticamente.

---

3. SIMULA√á√ÉO DE MONTE CARLO (O MULTIVERSO)
------------------------------------------

### Conceito
Em vez de tentar calcular a f√≥rmula exata para "Time A ganhar E ter mais de 10 cantos E sair gol no 1¬∫ tempo" (o que seria uma f√≥rmula gigante), n√≥s simulamos o jogo 10.000 vezes.

### üß† Deep Dive T√©cnico
Como funciona o m√©todo `.simulate_match_event()`:

1.  **Input:** Recebemos o $\lambda_{home}$ (M√©dia esperada Casa) e $\lambda_{away}$ (M√©dia esperada Fora) vindos do Machine Learning h√≠brido.
2.  **Sampling:** O computador gera 10.000 n√∫meros aleat√≥rios seguindo a curva (Poisson ou N-Binom) definida pelos lambdas.
    *   `Simula√ß√£o 1: Casa=5, Fora=4 -> Total=9`
    *   `Simula√ß√£o 2: Casa=8, Fora=2 -> Total=10`
    *   ...
    *   `Simula√ß√£o 10000: Casa=6, Fora=5 -> Total=11`
3.  **Infer√™ncia:**
    *   Para saber a probabilidade de "Over 9.5", basta contar quantas simula√ß√µes tiveram Total $\ge 10$.
    *   $P(Over 9.5) = \frac{\text{Count}(\text{Sims} \ge 10)}{10000}$

Essa abordagem "for√ßa bruta" converge para a probabilidade real (Lei dos Grandes N√∫meros) e permite calcular odds para QUALQUER mercado complexo (ex: Asian Handicap, Race to 5 Corners) sem mudar a matem√°tica base.

---

4. FEATURE ENGINEERING (ENGENHARIA DE DADOS)
--------------------------------------------

### Conceito
Quais dados importam? O modelo v9.0 cria "features" (vari√°veis) inteligentes.

### üß† Deep Dive T√©cnico

A. **Decaimento Exponencial (EWMA - Exponential Weighted Moving Average)**
   *   F√≥rmula: $S_t = \alpha Y_t + (1-\alpha) S_{t-1}$
   *   Onde $\alpha$ define a "meia-vida" (usamos ~14 dias).
   *   *Por que?* Um jogo de 3 dias atr√°s tem peso 0.9. Um jogo de 30 dias atr√°s tem peso 0.2. O modelo foca na **forma atual**.

B. **H2H Dominance (Domin√¢ncia no Confronto)**
   *   Calculamos o delta entre a m√©dia do time contra *este* oponente espec√≠fico vs a m√©dia dele contra *todos*.
   *   `Feature = M√©dia_H2H - M√©dia_Global`
   *   Isso captura "freguesia".

C. **Pressure Efficiency (Efici√™ncia de Press√£o)**
   *   `Feature = Corners / (Dangerous Attacks + 1)`
   *   Mede quantos ataques perigosos o time precisa para gerar 1 escanteio.
   *   Times que cruzam muito (ex: Liverpool) t√™m alta efici√™ncia. Times que tocam muito na entrada da √°rea (ex: Arsenal antigo) t√™m baixa efici√™ncia em cantos.

---

5. ARQUITETURA DO SISTEMA (PIPELINE)
------------------------------------

[SofaScore] 
     ‚¨á (JSON via HTTP)
[Scraper Class] -> Limpeza e Padroniza√ß√£o
     ‚¨á (Pandas DataFrame)
[Feature Engineering V2] -> Cria√ß√£o de vetores matem√°ticos
     ‚¨á (Matrix [X, y])
[LightGBM Regressor] -> Treino com Objective Tweedie
     ‚¨á (Modelo .pkl)
[API Server] -> Carrega .pkl em mem√≥ria RAM
     ‚¨á
[Endpoint /analyze] -> Executa previs√£o em < 50ms

---

6. COMO USAR O SISTEMA (OPERACIONAL)
------------------------------------
Regra de ouro: **Bons dados = Boas previs√µes.**

A. **Atualizar (Sexta-feira):** 
   - Op√ß√£o 9 no Menu.
   - O sistema baixa jogos novos e aprende com o que aconteceu ontem.

B. **Treinar (Ap√≥s Atualizar):** 
   - Op√ß√£o 2 no Menu.
   - O matem√°tico (IA) estuda as provas novas.

C. **Analisar (Dia de jogo):**
   - Use o **Scanner** para ver os melhores jogos.
   - Olhe o **Score** e a **Probabilidade**.
   - Se Probabilidade > 70% e Odd > 1.50, √© uma oportunidade "Easy" (Segura).

---

Espero que este n√≠vel de detalhe ajude a entender a engenharia robusta por tr√°s do sistema. N√£o √© apenas "pegar dados", √© modelagem estat√≠stica profissional.
